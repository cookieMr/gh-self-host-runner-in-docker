services:

  github-runner-1:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: github-runner-1
    environment:
      - GITHUB_OWNER=${GITHUB_OWNER}
      - GITHUB_REPOSITORY=${GITHUB_REPOSITORY}
      - GITHUB_PAT=${GITHUB_PAT}
      - RUNNER_NAME=docker-runner-cookieMr-1
      - RUNNER_LABELS=self-hosted,linux,x64
    volumes:
      - github_runner_data_1:/home/docker/actions-runner
      - /var/run/docker.sock:/var/run/docker.sock
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "ps aux | grep -q actions-runner"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    deploy:
      resources:
        limits:
          cpus: "1"
          memory: 2048M
  
  github-runner-2:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: github-runner-2
    environment:
      - GITHUB_OWNER=${GITHUB_OWNER}
      - GITHUB_REPOSITORY=${GITHUB_REPOSITORY}
      - GITHUB_PAT=${GITHUB_PAT}
      - RUNNER_NAME=docker-runner-cookieMr-2
      - RUNNER_LABELS=self-hosted,linux,x64
    volumes:
      - github_runner_data_2:/home/docker/actions-runner
      - /var/run/docker.sock:/var/run/docker.sock
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "ps aux | grep -q actions-runner"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    deploy:
      resources:
        limits:
          cpus: "1"
          memory: 2048M

  github-runner-3:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: github-runner-3
    environment:
      - GITHUB_OWNER=${GITHUB_OWNER}
      - GITHUB_REPOSITORY=${GITHUB_REPOSITORY}
      - GITHUB_PAT=${GITHUB_PAT}
      - RUNNER_NAME=docker-runner-cookieMr-3
      - RUNNER_LABELS=self-hosted,linux,x64
    volumes:
      - github_runner_data_3:/home/docker/actions-runner
      - /var/run/docker.sock:/var/run/docker.sock
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "ps aux | grep -q actions-runner"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    deploy:
      resources:
        limits:
          cpus: "1"
          memory: 2048M

volumes:
  github_runner_data_1:
  github_runner_data_2:
  github_runner_data_3:
